import telebot
import requests
from os import getenv
import random

# Настройки
BOT_TOKEN = getenv('BOT_TOKEN')  # Вставьте токен вашего бота
AUTH_TOKEN = getenv('AUTH_TOKEN')  # Токен авторизации
bot = telebot.TeleBot(BOT_TOKEN)

# Рандомные фразы для бабушки
random_phrases = [
    "Ой, опять что-то нажала не туда... Ну ничего, разберёмся!",
    "Ах, интернет — такая интересная штука! Столько всего нового узнаю.",
    "Слышу, ты что-то хочешь мне показать? Ну, давай посмотрим!",
    "Интернет — это как большой магазин, а я всё подряд рассматриваю!",
    "Ай-ай-ай, всё мелькает... Что я тут опять нажала?! Ну да ладно, посмотрим!",
    "Молодёжь всегда что-то интересное находит, ну что ж, давай посмотрим!"
]
No_link = [
    "Ой, внучек, у меня кнопки все мелкие, а глаза-то уже не те. Боюсь промахнуться не туда!",
    "Что ты мне там прислал? А вдруг это вирус, а у меня и антивируса-то нет!",
    "Зачем мне твои ссылки? У меня и без этого полный интернет!",
    "Ты лучше словами расскажи, что там интересного. Мне читать проще, чем тыкать!",
    "Ой, у меня интернет сейчас отключен, экономлю гигабайты.",
    "Я что-то нажму, и всё, компьютер сломается! Ты знаешь, я в этом деле профан.",
    "Ты мне лучше распечатай, внучек, на бумажке покажи!",
    "А если это мне потом весь телефон засорит? Я ничего не хочу качать!",
    "Ссылки-то я боюсь, мало ли там мошенники! Сейчас такие хитрые, внучек!",
    "Ой, у меня там рекламы потом на полэкрана появятся. Я в прошлом раз тыкнула — потом не знала, как всё закрыть!"
]

# Команда /start
@bot.message_handler(commands=["start"])
def send_welcome(message):
    bot.reply_to(message, "Ой, мой золотой, привет тебе! Я тут сижу, старушка, в интернете, по кнопочкам тыкаю... Не знаю, куда попаду, но всегда интересно! Напиши мне что-нибудь, я обязательно кликну, если увижу!")

# Слушаем все входящие сообщения
@bot.message_handler(func=lambda message: True)
def handle_message(message):
    shans = random.randint(0, 4)
    if shans == 0:
        # Если в сообщении есть ссылка, бабушка с радостью по ней перейдёт!
        if "http://" in message.text or "https://" in message.text:
            target_url = message.text
            random_phrase = random.choice(random_phrases)
            bot.reply_to(message, f"{random_phrase} Сейчас я по этой ссылке как будто в другой мир отправлюсь!")

            try:
                # Бабушка осторожно нажимает на ссылку
                response = requests.get(target_url, headers={"Cookie": f"session={AUTH_TOKEN}"})
                bot.reply_to(message, f"Ого, вкусно должно быть A что я там увидела... ")
            except Exception as e:
                bot.reply_to(message, f"Ой-ой, что-то пошло не так. Опять эти технологии... Ошибка: {e}. Но ничего, я не переживаю!")

        else:
            # Если нет ссылки, бабушка всё равно отреагирует
            bot.reply_to(message, "Ах, милок, я хочу чтонибудь приготовить, скинь рецепт, а я сразу в приготовлю его!")
    else:
        # Если бабушка не уверена в ссылке, она рандомно отвечает
        bot.reply_to(message, random.choice(No_link))
        
# Запуск бота
bot.polling()
